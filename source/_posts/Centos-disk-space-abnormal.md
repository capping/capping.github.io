---
title: Linux服务器磁盘空间不足异常
date: 2018-08-28 10:32:24
tags: [centos, linux]
categories: [Linux]
---

昨天连接数据库的时候出现如下错误:
> got error 28 from storage engine

经过搜索引擎了解到原来是磁盘空间不足了。登陆服务器。输入以下命令
```
df -h
```
果然磁盘占用 100% 了！怎么办？ 删日志吧。
```
# 进入根目录
cd /

# 查看当前目录下的磁盘占用情况， 然后一步步分析看哪些文件占用较大
du -sh *

# 在这步发现磁盘占用情况最多 30% 的样子，百思不得解
```
结果令人失望，删掉日志文件磁盘占用情况依旧 95% 以上。但是就这样吧， 起码数据库能访问了

今天过来磁盘占用又 100% 了

于是就想到了 是不是删除了文件 但是对应的进程并没有被杀掉

```
lsof | grep deleted
```
果然发现了端倪, 于是kill掉文件对应的进程号 再 df -h 看存储 恢复正常~

或者下面的命令会一次全删掉
> lsof |awk '/deleted/{print $2}'|xargs kill -9

然后 `df -h`, 看到磁盘占用回到了 28%
